!function(e,r,o){"use strict";if("undefined"!=typeof dokan_paypal&&dokan_paypal.is_checkout_page&&"smart"===dokan_paypal.payment_button_type){var a={checkout_form:e("form.checkout, form#order_review"),order_success_redirect_url:"",order_cancel_redirect_url:"",selected_payment_method:"",order_id:"",loaded:!1,toggle_buttons:function(r){var o="dokan_paypal_marketplace"===r,a=o?"show":"hide",t=o?"hide":"show";e("#paypal-button-container").animate({opacity:a,height:a,padding:a},230),e("#place_order").animate({opacity:t,height:t,padding:t},230)},on_change:function(){e("form.checkout, form#order_review").on("click",'input[name="payment_method"]',(function(e){"smart"===dokan_paypal.payment_button_type&&a.selected_payment_method!==e.target.value&&(a.selected_payment_method=e.target.value,a.toggle_buttons(e.target.value))}))},reset_order_data:function(){this.order_success_redirect_url="",this.order_cancel_redirect_url="",this.order_id=""},is_paypal_selected:function(){return"dokan_paypal_marketplace"===e(".woocommerce-checkout").find('input[name="payment_method"]:checked').val()},set_loading_on:function(){a.checkout_form.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},set_loading_done:function(){a.checkout_form.removeClass("processing").unblock()},submit_error:function(r){a.set_loading_done(),a.reset_order_data(),e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),a.checkout_form.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+r+"</div>"),a.checkout_form.find(".input-text, select, input:checkbox").trigger("validate").trigger("blur"),a.scroll_to_notice(),e(o.body).trigger("checkout_error",[r])},scroll_to_notice:function(){e("html, body").animate({scrollTop:e("form.checkout, form#order_review").offset().top-100},1e3)},set_order:function(){return e.ajax({type:"POST",url:wc_checkout_params.checkout_url,data:a.checkout_form.serialize(),dataType:"json"}).fail((function(e,r,o){a.submit_error('<div class="woocommerce-error">'+o+"</div>")}))},create_order:function(){a.set_loading_on();var r={order_id:dokan_paypal.order_id,action:"dokan_paypal_create_order",nonce:dokan_paypal.nonce};return e.ajax({type:"POST",url:dokan_paypal.ajaxurl,data:r,dataType:"json"}).fail((function(e,r,o){a.set_loading_done(),a.submit_error('<div class="woocommerce-error">'+o+"</div>")}))},do_submit:function(){return a.set_loading_on(),dokan_paypal.is_checkout_pay_page?a.create_order():a.set_order()},capture_payment:function(o,t){var c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];a.set_loading_on();var n={order_id:o,action:"dokan_paypal_capture_payment",nonce:dokan_paypal.nonce};e.ajax({type:"POST",url:dokan_paypal.ajaxurl,data:n,dataType:"json"}).done((function(e){a.set_loading_done();try{if(!e.success){if(e.data.message.details){if("INSTRUMENT_DECLINED"===e.data.message.details[0].issue)return c.restart();var o=e.data.message.details[0].description?e.data.message.details[0].description:e.data.message.message;throw new Error(o)}throw new Error(e.data.message)}r.location.href=t}catch(o){if(!0===e.reload)return void r.location.reload();e.data.message&&a.submit_error('<div class="woocommerce-error">'+e.data.message+"</div>")}})).fail((function(e,r,o){a.set_loading_done(),a.submit_error('<div class="woocommerce-error">'+o+"</div>")}))},render_ajax_response:function(e){try{if(dokan_paypal.is_checkout_pay_page&&(e=e.data.data),a.set_loading_done(),"success"===e.result)return a.order_success_redirect_url=e.success_redirect,a.order_cancel_redirect_url=e.cancel_redirect,a.order_id=e.id,e.paypal_order_id;throw"failure"===e.result?new Error("Result failure"):new Error("Invalid response")}catch(t){return!0===e.reload&&r.location.reload(),!0===e.refresh&&jQuery(o.body).trigger("update_checkout"),e.messages?a.submit_error(e.messages):a.submit_error('<div class="woocommerce-error">'+wc_checkout_params.i18n_checkout_error+"</div>"),!1}},init_hosted_fields:function(){dokan_paypal.is_ucc_enabled&&r.paypal.HostedFields.isEligible()&&r.paypal.HostedFields.render({createOrder:function(){return!!a.is_paypal_selected()&&a.do_submit().then((function(e){return a.render_ajax_response(e)}))},styles:{input:{"font-size":"17px","font-family":"helvetica, tahoma, calibri, sans-serif",color:"#3a3a3a"},":focus":{color:"black"}},fields:{number:{selector:"#dpm_card_number",placeholder:dokan_paypal.ucc_fields_placeholder.card_number},cvv:{selector:"#dpm_cvv",placeholder:dokan_paypal.ucc_fields_placeholder.cvv_number},expirationDate:{selector:"#dpm_card_expiry",placeholder:dokan_paypal.ucc_fields_placeholder.expiry_date}}}).then((function(r){var t;r.on("validityChange",(function(o){o.fields[o.emittedBy];var a=r.getState();(t=Object.keys(a.fields).every((function(e){return a.fields[e].isValid?a.fields[e].container.style.boxShadow="inset 2px 0 0 #0f834d":a.fields[e].container.style.boxShadow="inset 2px 0 0 #cc0000",a.fields[e].isValid})))?e("#pay_unbranded_order").attr("disabled",!1):e("#pay_unbranded_order").attr("disabled",!0)})),e("#pay_unbranded_order").on("click",(function(c){if(c.preventDefault(),e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),!t)return a.submit_error('<div class="woocommerce-error">'+dokan_paypal.card_info_error_message+"</div>"),!1;var n={};n=dokan_paypal.billing_address?dokan_paypal.billing_address:{streetAddress:o.getElementById("billing_address_1").value,extendedAddress:o.getElementById("billing_address_2").value,region:o.getElementById("billing_state").value,locality:o.getElementById("billing_city").value,postalCode:o.getElementById("billing_postcode").value,countryCodeAlpha2:o.getElementById("billing_country").value};var d={contingencies:["3D_SECURE"],cardholderName:o.getElementById("dpm_name_on_card").value,billingAddress:n};r.submit(d).then((function(e){a.capture_payment(a.order_id,a.order_success_redirect_url)})).catch((function(e){a.submit_error('<div class="woocommerce-error">'+e.message+"</div>")}))}))})).catch((function(e){a.submit_error('<div class="woocommerce-error">'+e.message+"</div>")}))},init_paypal:function(){if(r.paypal&&r.paypal.Buttons&&!a.loaded){a.loaded=!0,r.paypal.Buttons({createOrder:function(e,r){return!!a.is_paypal_selected()&&a.do_submit().then((function(e){return a.render_ajax_response(e)}))},onApprove:function(e,r){a.capture_payment(a.order_id,a.order_success_redirect_url,r)},onCancel:function(e){a.set_loading_done(),a.reset_order_data()},onError:function(e){a.set_loading_done(),0===a.checkout_form.find(".woocommerce-NoticeGroup > ul.woocommerce-error, .woocommerce-NoticeGroup-checkout > ul.woocommerce-error").length&&a.submit_error('<div class="woocommerce-error">'+e+"</div>")}}).render("#paypal-button-container").catch((function(e){a.submit_error('<div class="woocommerce-error">'+JSON.stringify(e)+"</div>")})),a.init_hosted_fields();var o=e(".woocommerce-checkout").find('input[name="payment_method"]:checked').val();a.toggle_buttons(o),a.on_change(),e(".paypal-loader").hide()}else a.loaded||setTimeout((function(){a.init_paypal()}),1e3)}};e(o).ready((function(){setTimeout((function(){a.init_paypal()}),3e3)}))}}(jQuery,window,document);