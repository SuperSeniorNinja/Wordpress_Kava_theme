(()=>{var e,t;e=jQuery,(t={slider:null,sliderValue:0,distance:0,init:function(){var a=t;this.slider=e(".store-lists-other-filter-wrap .dokan-geolocation-location-filters .dokan-range-slider"),this.sliderValue=this.slider.prev(".dokan-range-slider-value").find("span"),this.slider.on("input",this.setSliderValue),this.slider.on("change",this.setDistance),e(".store-lists-other-filter-wrap .dokan-geolocation-location-filters .location-address input").on("change",this.buildAddressQuery),a.bindAddressInput(),e(" #dokan-store-listing-filter-wrap .dokan-geolocation-filters-loading").remove()},buildAddressQuery:function(e){var a=t;a.setParam("address",e.target.value),e.target.value||(a.setParam("distance",""),a.setParam("longitude",""),a.setParam("latitude",""))},bindAddressInput:function(){window.google&&google.maps?this.bindeGoogleMap():e('[name="dokan_mapbox_access_token"]').val()&&this.bindMapbox()},bindeGoogleMap:function(){var a=t,n=e(".location-address");a.geocoder=new google.maps.Geocoder;var o=n.find("input");autocomplete=new google.maps.places.Autocomplete(o.get(0)),autocomplete.addListener("place_changed",(function(){var e=autocomplete.getPlace();if(e){var t=e.geometry.location;a.latitude=t.lat(),a.longitude=t.lng(),a.setAddress(e.formatted_address)}})),a.navigatorGetCurrentPosition((function(){a.geocoder.geocode({location:{lat:a.latitude,lng:a.longitude}},(function(e,t){var n="";"OK"===t&&(n=e[0].formatted_address),a.setAddress(n),o.val(n)}))}))},bindMapbox:function(){var a=t,n=e(".location-address").find("input"),o=n.get(0),i=new Suggestions(o,[],{minLength:3,limit:3,hideOnBlur:!1});i.getItemValue=function(e){return e.place_name},n.on("change",(function(){if(i.selected){var e=i.selected;a.latitude=e.geometry.coordinates[1],a.longitude=e.geometry.coordinates[0],a.setAddress(e.place_name)}}));var s=_.debounce((function(e,t){e.cancel&&e.cancel(),a.mapboxGetPlaces(t,(function(e){i.update(e)}))}),250);n.on("input",(function(){var t=e(this).val();s(s,t)})),a.navigatorGetCurrentPosition((function(){a.mapboxGetPlaces({lng:a.longitude,lat:a.latitude},(function(e){if(e&&e.length){var t=e[0].place_name;a.setAddress(t),n.val(t)}}))}))},navigatorGetCurrentPosition:function(a){var n=t,o=e(".location-address").find(".locate-icon"),i=o.next();navigator.geolocation&&o.removeClass("dokan-hide").on("click",(function(){o.addClass("dokan-hide"),i.removeClass("dokan-hide"),navigator.geolocation.getCurrentPosition((function(e){o.removeClass("dokan-hide"),i.addClass("dokan-hide"),n.latitude=e.coords.latitude,n.longitude=e.coords.longitude,a()}),(function(){o.removeClass("dokan-hide"),i.addClass("dokan-hide")}))}))},mapboxGetPlaces:function(t,a){if(t){var n=e('[name="dokan_mapbox_access_token"]').val();t.lng&&t.lat&&(t=t.lng+"%2C"+t.lat);var o="https://api.mapbox.com/geocoding/v5/mapbox.places/"+t+".json?access_token="+n+"&cachebuster="+ +new Date+"&autocomplete=true";e.ajax({url:o,method:"get"}).done((function(e){e.features&&"function"==typeof a&&a(e.features)}))}},setAddress:function(e){var a=t;if(a.setParam("address",e),!a.distance){var n=0,o=a.slider.val();if(o)n=o;else{var i=parseInt(a.slider.attr("min"),10),s=parseInt(a.slider.attr("max"),10);n=Math.ceil((i+s)/2)}a.setParam("distance",n)}a.setParam("latitude",a.latitude),a.setParam("longitude",a.longitude)},setParam:function(e,t){t?dokan.storeLists.query[e]=t:delete dokan.storeLists.query[e]},setSliderValue:function(e){t.sliderValue.html(e.target.value)},setDistance:function(e){t.setParam("distance",e.target.value)}}).init()})();