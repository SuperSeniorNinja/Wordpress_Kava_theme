(()=>{var a,d;a=jQuery,d={init:function(){this.threeDs2.init(),this.payOptions.init()},threeDs2:{init:function(){a("#dokan-mangopay-3ds2-js").val("yes"),a("#dokan-mangopay-3ds2-lang").val(navigator.language),a("#dokan-mangopay-3ds2-color-depth").val(window.screen.colorDepth),a("#dokan-mangopay-3ds2-screen-height").val(screen.height),a("#dokan-mangopay-3ds2-screen-width").val(screen.width),a("#dokan-mangopay-3ds2-timezone-offset").val((new Date).getTimezoneOffset().toString()),a("#dokan-mangopay-3ds2-user-agent").val(navigator.userAgent),1==navigator.javaEnabled?a("#dokan-mangopay-3ds2-java").val("yes"):a("#dokan-mangopay-3ds2-java").val("no")}},payOptions:{init:function(){var d=this;a("#dokan-mangopay-card-type").on("change click",(function(d){a(".dokan-mangopay-payment-type.card").attr("checked","checked")})),a("#dokan-mangopay-directdw-type").on("change click",(function(d){a(".dokan-mangopay-payment-type-directdebitweb").attr("checked","checked")})),a("#dokan-mp-add-card").hide(),a("#dokan-mp-card-registration-fields").hide(),a(document).on("change",'input[name="dokan_mangopay_payment_type"]',(function(){a("#dokan-mp-card-registration-fields").hide(),a("#dokan-mp-saved-cards-list").hide()})),a(document).on("click","#dokan-mp-add-card",(function(){a("#dokan-mp-card-registration-fields").toggle(),a("#dokan-mp-add-card").hide()})),a(document).on("click","#cancel_addcard",(function(){a("#dokan-mp-card-registration-fields").hide(),a("#dokan-mp-add-card").show()})),a(document).on("change",":radio",(function(){a("#dokan-mangopay-payment-type-registeredcard").is(":checked")||a("#dokan-mp-add-card").hide()})),a(document).on("change","#dokan-mangopay-payment-type-registeredcard:checked",d.cards.get),a(document).on("click","#dokan-mp-cancel-card",d.cards.cancel),a(document).on("click","#save_preauth_card_button",d.cards.save)},cards:{get:function(){a("#dokan-mp-card-save-processing").show(),a("#dokan-mp-saved-cards-list").show(),d.payOptions.cards.list()},cancel:function(d){d.preventDefault(),a("#dokan-mp-card-save-error").html("").hide();var n=a(this).data("cardid"),e={action:"dokan_mangopay_deactivate_card",card_id:n,_wpnonce:dokanMangopay.nonce};a.post(dokanMangopay.ajaxurl,e,(function(d){d.success?a("#dokan-mp-saved-card-line-"+n).remove():a("#dokan-mp-card-save-error").html(d.data).show()}))},save:function(){a("#dokan-mp-card-save-error").html("").hide();var n=a("#user_id").val();if(null!=n||0!=n||""!=n){selectedCardType=a("#registered_card_type").val();var e={action:"dokan_mangopay_register_card",user_id:n,order_currency:a("#order_currency").val(),card_type:selectedCardType,_wpnonce:dokanMangopay.nonce},o=a("#dokan-mp-client-id").val(),r=a("#preauth_ccdate_month").val(),c=a("#preauth_ccdate_year").val();1==r.length&&(r="0"+r);var t=r+""+c,s={cardNumber:a("#dokan-mp-ccnumber").val(),cardExpirationDate:t,cardCvx:a("#dokan-mp-cccrypto").val(),cardType:selectedCardType};if(!(selectedCardType&&r&&c&&s.cardNumber&&s.cardCvx))return a("#dokan-mp-card-registration-fields").show(),a("#dokan-mp-card-save-error").html(dokanMangopay.emptyFields),void a("#dokan-mp-card-save-error").show();a("#dokan-mp-card-registration-fields").hide(),a("#dokan-mp-card-save-processing").show(),a.post(dokanMangopay.ajaxurl,e,(function(n){n.success?d.payOptions.cards.register(n.data.CardRegistrationId,n.data.CardRegistrationURL,n.data.PreregistrationData,n.data.AccessKey,o,s):(a("#dokan-mp-card-registration-fields").show(),a("#dokan-mp-card-save-error").html(n.error),a("#dokan-mp-card-save-error").show())}))}},register:function(n,e,o,r,c,t){mangoPay.cardRegistration.baseURL=a("#dokan-mangopay-url").val(),mangoPay.cardRegistration.clientId=c,mangoPay.cardRegistration.init({cardRegistrationURL:e,preregistrationData:o,accessKey:r,Id:n}),mangoPay.cardRegistration.registerCard(t,(function(n){d.payOptions.cards.list(),a("#dokan-mp-card-save-processing").hide(),d.payOptions.cards.update(n.cardRegId,n.cardRegData)}),(function(d){a("#dokan-mp-card-registration-fields").show(),a("#dokan-mp-card-save-error").html(dokanMangopay.regErrors.base_message+": "+dokanMangopay.regErrors[d.ResultCode]),a("#dokan-mp-card-save-error").show(),a("#dokan-mp-card-save-processing").hide()}))},list:function(){a("#dokan-mp-saved-cards-list").html("").show();var d={action:"dokan_mangopay_get_registered_cards",user_id:a("#user_id").val(),_wpnonce:dokanMangopay.nonce};a.post(dokanMangopay.ajaxurl,d,(function(d){a("#dokan-mp-saved-cards-list").html(d.data),a("#dokan-mp-card-save-processing").hide(),setTimeout((function(){parseInt(a("#dokan-mp-card-saved").length)>=1&&1==parseInt(a("#dokan-mp-card-saved").val())?(a("#dokan-mp-card-registration-fields").hide(),a("#dokan-mp-add-card").show(),a("#cancel_addcard").show()):(a("#dokan-mp-card-registration-fields").show(),a("#dokan-mp-add-card").hide(),a("#cancel_addcard").hide())}),500)}))},update:function(n,e){var o={action:"dokan_mangopay_update_card",card_id:n,reg_data:e,_wpnonce:dokanMangopay.nonce};console.log(o),a.post(dokanMangopay.ajaxurl,o,(function(n){n.success&&(d.payOptions.cards.list(),a("#dokan-mp-ccnickname").val(""),a("#dokan-mp-ccnumber").val(""),a("#dokan-mp-ccdate").val(""),a("#dokan-mp-cccrypto").val(""),a("#dokan-mp-card-save-processing").hide(),a("#dokan-mp-card-registration-fields").show())}))}}}},a(document).ready((function(){d.init()}))})();