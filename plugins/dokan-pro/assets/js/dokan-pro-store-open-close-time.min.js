(()=>{var o,e,n,t,a,r,i,s,c;o=jQuery,e=dokanMultipleTime.step,n=dokanMultipleTime.format,t=dokanMultipleTime.openingMaxTime,a=dokanMultipleTime.openingMinTime,r=dokanMultipleTime.closingMaxTime,i=dokanMultipleTime.closingMinTime,s={init:function(){o(".dokan-store-times").on("click",".open-close-actions a",this.stopDefaultBehaviour),o(".dokan-store-times").on("focus",".dokan-form-control",this.changeClockTimeOnFocus),o(".dokan-store-times").each(this.onLoadContainer),o(".dokan-store-times").on("click",".added-store-opening-time",this.addedStoreMultipleTime),o(".dokan-store-times").on("click",".remove-store-closing-time",this.removeStoreMultipleTime),o('input[name="dokan_update_store_settings"]').on("click",this.updateStoreSettings),o(".dokan-store-times").on("change",".dokan-form-group",this.changeDokanOpenCloseTime),o(".dokan-store-times").on("change",".opening-time",this.changeSlotAfterOpeningUpdate)},stopDefaultBehaviour:function(o){o.stopPropagation(),o.preventDefault()},changeClockTimeOnFocus:function(s){s.stopPropagation();var c=o(this);c.closest(".dokan-form-group").find(".time .clock-picker .dokan-form-control:eq(0)").timepicker({scrollDefault:"now",minTime:a,maxTime:t,timeFormat:n,step:e}),c.closest(".dokan-form-group").find(".time .clock-picker .dokan-form-control:eq(1)").timepicker({scrollDefault:"now",minTime:i,maxTime:r,timeFormat:n,step:e})},onLoadContainer:function(e){o(this).find(".dokan-form-group").each((function(e){var n=o(this),t=n.find(".time .clock-picker .dokan-form-control:eq(1)").val(),a=n.closest(".dokan-form-group").find("span.and-time"),i=moment(r,dokan_get_i18n_time_format()).format("HH:mm");moment(t,dokan_get_i18n_time_format()).format("HH:mm")===i&&n.find(".added-store-opening-time").css({visibility:"hidden"}),void 0===a[0]&&(n.find(".remove-store-closing-time").css({color:"#bbb"}),n.find(".remove-store-closing-time").removeAttr("class"))}))},addedStoreMultipleTime:function(e){var n=o(this),t=n.closest(".dokan-store-times").find(".dokan-form-group .dokan-form-control").get(0).id,a=n.closest(".dokan-store-times").find(".dokan-form-group .dokan-form-control").get(1).id,r=n.closest(".dokan-store-times").find(".dokan-form-group .dokan-form-control").get(0).name,i=n.closest(".dokan-store-times").find(".dokan-form-group .dokan-form-control").get(1).name,s="<div class='dokan-form-group'>\n                                    <span class='and-time'></span>\n                                    <label for='opening-time' class='time'>\n                                        <div class='clock-picker'>\n                                            <span class='fa fa-clock-o' aria-hidden='true'></span>\n                                            <input type='text'\n                                                class='dokan-form-control opening-time'\n                                                name='".concat(r,"'\n                                                id='").concat(t,"'\n                                                placeholder='").concat(dokanMultipleTime.placeholder,"'\n                                                autocomplete='off'\n                                                value=''>\n                                            <span class='fa fa-exclamation-triangle'></span>\n                                        </div>\n                                    </label>\n                                    <span class='time-to'> &#45; </span>\n                                    <label for='closing-time' class='time'>\n                                        <div class='clock-picker'>\n                                            <span class='fa fa-clock-o' aria-hidden='true'></span>\n                                            <input type='text'\n                                                class='dokan-form-control closing-time'\n                                                name='").concat(i,"'\n                                                id='").concat(a,"'\n                                                placeholder='").concat(dokanMultipleTime.placeholder,"'\n                                                autocomplete='off'\n                                                value=''>\n                                            <span class='fa fa-exclamation-triangle'></span>\n                                        </div>\n                                    </label>\n                                    <label for='open-close-actions' class='time open-close-actions' style='display: flex; align-items: center;'>\n                                        <a href='' class='remove-store-closing-time'>\n                                            <span class='fa fa-times' aria-hidden='true'></span>\n                                        </a>\n                                        <a href='' class='added-store-opening-time'>\n                                            <span class='fa fa-plus' aria-hidden='true' ></span>\n                                        </a>\n                                    </label>\n                                </div>");n.closest(".dokan-form-group").after(s),n.closest(".dokan-form-group").next(".dokan-form-group").hide(0,(function(){o(this).slideDown(300)}))},removeStoreMultipleTime:function(e){var n=o(this),t=n.closest(".dokan-form-group").prev(".dokan-form-group").find("span.and-time"),a=n.closest(".dokan-form-group").next(".dokan-form-group");if(void 0===t[0]&&void 0===a[0]&&(n.closest(".dokan-form-group").prev(".dokan-form-group").find(".remove-store-closing-time span").css({color:"#bbb"}),n.closest(".dokan-form-group").prev(".dokan-form-group").find(".open-close-actions a:eq(0)").removeAttr("class")),void 0!==a[0]){var r=a.find(".time .dokan-form-control:eq(0)").val(),i=n.closest(".dokan-form-group").prev(".dokan-form-group").find(".time .dokan-form-control:eq(1)").val(),s=moment(r,dokan_get_i18n_time_format()).format("HH:mm");moment(i,dokan_get_i18n_time_format()).format("HH:mm")<s&&(n.closest(".dokan-form-group").next(".dokan-form-group").find(".time .clock-picker:eq(0)").css({"border-color":"#bbb"}),n.closest(".dokan-form-group").next(".dokan-form-group").find(".time .clock-picker:eq(0) .fa-clock-o").css({color:"#666"}),n.closest(".dokan-form-group").next(".dokan-form-group").find(".time .dokan-form-control:eq(0)").css({color:"#4e4e4e"}))}n.closest(".dokan-form-group").slideUp(300,(function(){o(this).remove()}))},changeDokanOpenCloseTime:function(e){e.stopPropagation();var n=o(this),t=n.find(".time .clock-picker .dokan-form-control:eq(1)").val(),a=moment(t,dokan_get_i18n_time_format()).format("HH:mm"),i=moment(r,dokan_get_i18n_time_format()).format("HH:mm");o(".ui-timepicker-wrapper").hide(),n.find(".added-store-opening-time").css({visibility:"visible"}),i===a&&n.find(".added-store-opening-time").css({visibility:"hidden"}),o(".dokan-store-times").each((function(){for(var e=o(this).find(".dokan-form-group").length,n=0;n<e;n++){var t=o(this),a=t.find(".dokan-form-group:eq("+n+") .time .clock-picker .dokan-form-control:eq(0)").val(),r=t.find(".dokan-form-group:eq("+n+") .time .clock-picker .dokan-form-control:eq(1)").val(),i=moment(a,dokan_get_i18n_time_format()).format("HH:mm"),s=moment(r,dokan_get_i18n_time_format()).format("HH:mm");a&&(r&&i>s?(t.find(".dokan-form-group:eq("+n+") .time .clock-picker .dokan-form-control").focus(),t.find(".dokan-form-group:eq("+n+") .time .clock-picker").css({"border-color":"#F87171"}),t.find(".dokan-form-group:eq("+n+") .time .fa-clock-o").css({color:"#F87171"}),t.find(".dokan-form-group:eq("+n+") .time .dokan-form-control").css({color:"#F87171"})):(t.find(".dokan-form-group:eq("+n+") .time .dokan-form-control").css({color:"#4e4e4e"}),t.find(".dokan-form-group:eq("+n+") .time .clock-picker").css({"border-color":"#bbb"}),t.find(".dokan-form-group:eq("+n+") .time .fa-clock-o").css({color:"#666"}))),a&&r?t.find(".dokan-form-group:eq("+n+") .time .fa-exclamation-triangle").css({display:"none"}):(t.find(".dokan-form-group:eq("+n+") .time .clock-picker").css({"border-color":"#F5C33B"}),t.find(".dokan-form-group:eq("+n+") .time .fa-exclamation-triangle").css({display:"block"}))}}))},updateStoreSettings:function(e){o(".dokan-store-times").each((function(){var n=0,t=o(this).find(".dokan-form-group").length,a=[];for(o(".store-day-selectbox option:selected").each((function(){var e=o(this).attr("data-tag");a.push(e)}));n<t;n++){var r=o(this),i=r.attr("id"),c=r.find(".dokan-form-group:eq("+n+")").prev(".dokan-form-group"),l=r.find(".dokan-form-group:eq("+n+") .time .clock-picker .dokan-form-control:eq(0)").val(),d=r.find(".dokan-form-group:eq("+n+") .time .clock-picker .dokan-form-control:eq(1)").val(),m=r.find(".dokan-form-group:eq("+(n-1)+") .dokan-form-control:eq(1)").val(),f=moment(l,dokan_get_i18n_time_format()).format("HH:mm"),p=moment(d,dokan_get_i18n_time_format()).format("HH:mm"),k=moment(m,dokan_get_i18n_time_format()).format("HH:mm");if(-1!==o.inArray(i,a)){if(!l)return s.updateSettingsView(r,n,i,150,0),e.preventDefault(),!1;if(!d)return s.updateSettingsView(r,n,i,150,1),e.preventDefault(),!1;if(f>p)return s.updateSettingsView(r,n,i,300),e.preventDefault(),!1;if(void 0!==c[0]&&m&&f<k)return s.updateSettingsView(r,n,i,300,0),e.preventDefault(),!1}}return!0}))},updateSettingsView:function(e,n,t,a){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return function(r){r=!1!==r?":eq(".concat(r,")"):"",e.find(".dokan-form-group:eq("+n+") .time .clock-picker .dokan-form-control"+r).focus(),e.find(".dokan-form-group:eq("+n+") .time .clock-picker"+r).css({"border-color":"#F87171"}),e.find(".dokan-form-group:eq("+n+") .time .clock-picker"+r+" .fa-clock-o").css({color:"#F87171"}),e.find(".dokan-form-group:eq("+n+") .time .dokan-form-control"+r).css({color:"#F87171"}),o(".tabs li").removeClass("active"),o(".dokan-store-times.panel").removeClass("active").attr("style","display: none;"),o(".tabs li[rel="+t+"]").addClass("active"),o("#"+t).addClass("active").attr("style","display: block;"),o("html, body").animate({scrollTop:o(".time-slot-tabs").offset().top-120},a)}(r)},changeSlotAfterOpeningUpdate:function(){var e=o(this),n=e.closest(".dokan-store-times").attr("id"),t=e.val(),a=e.closest(".dokan-form-group").find(".closing-time").val(),r=o("#"+n).find(".dokan-form-group").length-1,i=e.val(),s=o("#"+n+" .opening-time").serializeArray(),c=e.closest(".dokan-form-group").next(".dokan-form-group"),l=e.closest(".dokan-form-group").prev(".dokan-form-group"),d=[],m=[];if(s.forEach((function(o,e){var n=moment(i,dokan_get_i18n_time_format()).format("HH:mm"),t=moment(o.value,dokan_get_i18n_time_format()).format("HH:mm");n<=t&&d.push(e),n>t&&m.push(e)})),0===d[0]&&void 0!==l[0]){var f=o("#"+n+" .dokan-form-group:eq(0)"),p=o("#"+n+" .dokan-form-group:eq(0) .opening-time").val(),k=o("#"+n+" .dokan-form-group:eq(0) .closing-time").val();f.slideUp(150,(function(){f.find(".opening-time").val(t),f.find(".closing-time").val(a),t&&a||(f.find(".clock-picker").css({"border-color":"#F5C33B"}),f.find(".fa-exclamation-triangle").css({display:"block"})),f.find(".time .clock-picker .fa-clock-o").css({color:"#666"}),f.find(".time .dokan-form-control").css({color:"#4e4e4e"}),f.slideDown(300)})),e.closest(".dokan-form-group").slideUp(150,(function(){e.closest(".dokan-form-group").find(".opening-time").val(p),e.closest(".dokan-form-group").find(".closing-time").val(k),e.closest(".dokan-form-group").find(".clock-picker").css({"border-color":"#bbb"}),e.closest(".dokan-form-group").find(".fa-exclamation-triangle").css({display:"none"}),o("#"+n+" .dokan-form-group:eq(1)").before(e.closest(".dokan-form-group").slideDown())}))}if(d[0]&&d[0]!==r&&e.closest(".dokan-form-group").slideUp(150,(function(){t&&a||(e.closest(".dokan-form-group").find(".clock-picker").css({"border-color":"#F5C33B"}),e.closest(".dokan-form-group").find(".fa-exclamation-triangle").css({display:"block"})),o("#"+n+" .dokan-form-group:eq("+d[0]+")").before(e.closest(".dokan-form-group").slideDown(300))})),m[m.length-1]&&void 0!==c[0]){if(void 0===l[0]){var u=e.closest(".dokan-form-group").find(".start-label"),g=e.closest(".dokan-form-group").find(".end-label");o("#"+n+" .dokan-form-group:eq(1) .clock-picker:eq(0)").before(u),o("#"+n+" .dokan-form-group:eq(1) .clock-picker:eq(1)").before(g),o("#"+n+" .dokan-form-group:eq(1) .remove-store-closing-time").removeAttr("class"),o("#"+n+" .dokan-form-group:eq(1) .open-close-actions a:eq(0)").css({color:"#bbb"}),o("#"+n+" .dokan-form-group:eq(0) .clock-picker:eq(0) .start-label").remove(),o("#"+n+" .dokan-form-group:eq(0) .clock-picker:eq(1) .end-label").remove(),o("#"+n+" .dokan-form-group:eq(0) .open-close-actions a:eq(0)").addClass("remove-store-closing-time"),o("#"+n+" .dokan-form-group:eq(0) .remove-store-closing-time").css({color:"#F87171"})}e.closest(".dokan-form-group").slideUp(150,(function(){t&&a||(e.closest(".dokan-form-group").find(".clock-picker").css({"border-color":"#F5C33B"}),e.closest(".dokan-form-group").find(".fa-exclamation-triangle").css({display:"block"})),o("#"+n+" .dokan-form-group:eq("+m[m.length-1]+")").after(e.closest(".dokan-form-group").slideDown(300))}))}}},c=[],o(".store-day-selectbox option").each((function(){o(this)[0].hasAttribute("selected")&&c.push(o(this).val())})),o(".store-day-selectbox").on("change",(function(){var e,n=o(this).val();e=n,c=[],o(".store-day-selectbox option").each((function(){var n=o(this),t=n.val();if(o.isArray(e)){var a=e.filter(s),r=o('.store-day-selectbox option[value="'+a[0]+'"]'),i=r.attr("data-tag");function s(o){return o===t}if(i)r.attr("selected","selected"),o('.tab-panels .tabs li[rel="'+i+'"]').removeClass("deactivated"),c.push(i);else{var l=o(this).attr("data-tag");n.removeAttr("selected"),o('.tab-panels .tabs li[rel="'+l+'"]').addClass("deactivated")}}})),0===c.length?o(".dokan-store-times .overlay").slideDown(300):o(".dokan-store-times .overlay").slideUp(300)})),o(".store-day-selectbox").select2({multiple:!0,placeholder:dokanMultipleTime.selectDefault,allowClear:!0,templateResult:function(e){if(e&&!e.selected)return o("<span>"+e.text+"</span>")}}),o(".store-day-selectbox").val(c).trigger("change"),o(".tab-panels .tabs li").each((function(){var e=o(this),n=e.attr("rel");e.filter("[class='active']"),c.includes(n)||e.addClass("deactivated")})),o(".tab-panels .tabs li").on("click",(function(){var e=o(this),n=e.attr("rel");if(!e.hasClass("active")&&c.includes(n)){var t=e.closest(".tab-panels");t.find(".tabs li.active").removeClass("active"),e.addClass("active"),e.removeClass("deactivated"),t.find(" .panel.active").slideUp(300,(function(){o(this).removeClass("active"),o("#"+n).slideDown(300,(function(){o(this).addClass("active")}))})),o("#"+n+" .time").css({visibility:"visible"})}})),o(document).ready((function(){s.init()}))})();